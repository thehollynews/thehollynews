<!DOCTYPE html>
<html>
<head>

	<title>Infinite Scroll Ads Test</title>

<style>
	button{
		background:green;
		padding:5px 15px;
		position: fixed;
		right: 30px;
		bottom: 30px;
		color: white;
	}
	.body{
		width: 700px;
	}
	.blog-content{
		min-height: 250px;
		border: 1px solid black;
	}

</style>
<script async src="https://www.googletagservices.com/tag/js/gpt.js"></script>

	<script type="text/javascript">


var googletag = googletag || {};
googletag.cmd = googletag.cmd || [];

var adslot0;

googletag.cmd.push(function() {
   // Declare any slots initially present on the page
  adslot0 = googletag.defineSlot('/181891612/ListDev_Mrec2_ROS', [300, 250],  'leaderboard').
  setTargeting("test","infinitescroll").
  addService(googletag.pubads());

  // Infinite scroll requires SRA
  googletag.pubads().enableSingleRequest();

  // Disable initial load, we will use refresh() to fetch ads.
  // Calling this function means that display() calls just
  // register the slot as ready, but do not fetch ads for it.
  googletag.pubads().disableInitialLoad();

  // Enable services
  googletag.enableServices();
});

googletag.cmd.push(function() {
  googletag.display('leaderboard');
  googletag.pubads().refresh([adslot0]);
});

 // Function to generate unique names for slots
 var nextSlotId = 1;
 function generateNextSlotName(mrec) {
   var id = nextSlotId++;
   return mrec + '-' + id;
 }


 // Function to add content to page, mimics real infinite scroll
 // but keeps it much simpler from a code perspective.



function createBlog(slot_div, slot_div2, slot_div3){
	console.log("create blog triggered");
	 var blog_content = document.createElement("div");
 blog_content.setAttribute('class', 'blog-content');

  var heading = document.createElement("h1");
  heading.innerHTML = "Hello this is a blog " + Math.random();
  var paragraph = document.createElement("p");

 paragraph.innerHTML = "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore\ et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea\ commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla\ pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.";

 blog_content.appendChild(heading);
 	blog_content.appendChild(slot_div);

 blog_content.appendChild(paragraph);
	blog_content.appendChild(slot_div2);
	blog_content.appendChild(paragraph);
	blog_content.appendChild(slot_div3);

	return blog_content

}

 function moreContent() {
   // Generate next slot name
   var slotName = generateNextSlotName('mrec1');
   var slotName2 = generateNextSlotName('mrec2');
   var slotName3 = generateNextSlotName('mrec3');

   // Create a div for the slot
   var slotDiv = document.createElement('div');
   slotDiv.id = slotName; // Id must be the same as slotName
   var slotDiv2 = document.createElement('div');
   slotDiv2.id = slotName2; // Id must be the same as slotName
   var slotDiv3 = document.createElement('div');
   slotDiv3.id = slotName3; // Id must be the same as slotName
   document.body.appendChild(createBlog(slotDiv, slotDiv2, slotDiv3));


   // Define the slot itself, call display() to
   // register the div and refresh() to fetch ad.
   googletag.cmd.push(function() {
     var slot = googletag.defineSlot('/21746012461/IS_thehealthandtech_test_1', [300, 250], slotName).
         setTargeting("test","infinitescroll").
         addService(googletag.pubads());
     var slot2 = googletag.defineSlot('/21746012461/IS_thehealthandtech_test_2', [300, 250], slotName2).
         setTargeting("test","infinitescroll").
         addService(googletag.pubads());
     var slot3 = googletag.defineSlot('/21746012461/IS_thehealthandtech_test_3', [300, 250], slotName3).
         setTargeting("test","infinitescroll").
         addService(googletag.pubads());


     //     var slot = googletag.defineSlot('/181891612/ListDev_Mrec1_ROS', [300, 250], slotName).
     //     setTargeting("test","infinitescroll").
     //     addService(googletag.pubads());
     // var slot2 = googletag.defineSlot('/181891612/ListDev_Mrec2_ROS', [300, 250], slotName2).
     //     setTargeting("test","infinitescroll").
     //     addService(googletag.pubads());
     // var slot3 = googletag.defineSlot('/181891612/ListDev_Mrec3_ROS', [300, 250], slotName3).
     //     setTargeting("test","infinitescroll").
     //     addService(googletag.pubads());




    window.history.pushState('page2', 'Title', '/test.html?page=page-'+ Math.random() );


     // Display has to be called before
     // refresh and after the slot div is in the page.
     googletag.display(slotName);
     googletag.pubads().refresh([slot, slot2, slot3]);
   });
 }
	</script>
</head>
<body>

	<div class="body">


		<h1>GPT Test Page - Infinite Scroll</h1>

		 <!-- First fake content -->
		<p>
			Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.

		</p>

		 <!-- First ad -->
		 <div id="leaderboard"></div>
	</div>
 <!-- Button to load more content dynamically. -->
 <button onclick="moreContent()">More Content</button>
</body>
</html>

